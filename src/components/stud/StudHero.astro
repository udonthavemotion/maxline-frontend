---
import { formatPrice, getImageUrl, isVideo, type Stud } from "@/lib/strapi";
import { Icon } from "astro-icon/components";

interface Props {
  stud: Stud;
}

const { stud } = Astro.props;
// ONLY use background_video field - no fallback to images array
const backgroundVideo = stud.background_video;
---

<section class="py-16 bg-gradient-to-br from-brand-navy to-brand-blue text-white">
  <div class="max-w-7xl mx-auto px-4">
    <div class="grid lg:grid-cols-2 gap-12 items-center">
      <!-- Hero Media -->
      <div class="order-2 lg:order-1">
        {backgroundVideo ? (
          <!-- Background Video -->
          <div class="relative rounded-2xl overflow-hidden shadow-2xl">
            <video 
              src={getImageUrl(backgroundVideo)}
              class="w-full h-[500px] object-cover"
              autoplay
              muted
              loop
              playsinline
            />
            
            <!-- Video Badge -->
            <div class="absolute top-4 right-4 bg-black/50 backdrop-blur-sm text-white px-3 py-1 rounded-full text-sm font-medium">
              VIDEO
            </div>
          </div>
        ) : (
          <!-- No Background Video - Show placeholder -->
          <div class="relative rounded-2xl overflow-hidden shadow-2xl bg-gray-200">
            <div class="w-full h-[500px] flex items-center justify-center bg-neutral-300">
              <div class="text-center text-gray-500">
                <Icon class="w-16 h-16 mx-auto mb-4" name="bx:bxs-video" />
                <p class="text-lg font-medium">No Background Video</p>
                <p class="text-sm text-gray-400 mt-2">Add a background video in Strapi admin</p>
              </div>
            </div>
          </div>
        )}
      </div>
      
      <!-- Hero Content -->
      <div class="order-1 lg:order-2 text-center lg:text-left">
        <div class="inline-flex items-center gap-2 bg-brand-orange px-4 py-2 rounded-full text-sm font-medium mb-4">
          <Icon class="w-4 h-4" name="bx:bxs-crown" />
          Champion Stud
        </div>
        
        <h1 class="text-5xl lg:text-6xl font-heading font-bold mb-6">
          {stud.name}
        </h1>
        
        <div class="text-2xl font-bold text-brand-orange mb-6">
          Stud Fee: {formatPrice(stud.fee)}
        </div>
        
        <div class="flex items-center gap-6 mb-8 justify-center lg:justify-start">
          {stud.age && (
            <div class="flex items-center gap-2">
              <Icon class="w-5 h-5 text-brand-orange" name="bx:bxs-calendar" />
              <span>{stud.age}</span>
            </div>
          )}
          
          <div class="flex items-center gap-2">
            <Icon class="w-5 h-5 text-brand-orange" name="bx:bxs-check-circle" />
            <span class="capitalize">{stud.availability}</span>
          </div>
        </div>
        
        {stud.description && (
          <div class="text-lg text-neutral-200 mb-8 leading-relaxed">
            {Array.isArray(stud.description) ? (
              stud.description.map((block, index) => (
                block.type === 'paragraph' && (
                  <p class="mb-4">
                    {block.children.map((child, childIndex) => (
                      <span>{child.text}</span>
                    ))}
                  </p>
                )
              ))
            ) : (
             <p>{stud.description}</p>
           )}
          </div>
        )}
        
        <div class="flex flex-col sm:flex-row gap-4 justify-center lg:justify-start">
          <a 
            href="#contact" 
            class="bg-brand-orange hover:bg-orange-600 text-white px-8 py-3 rounded-lg font-medium transition-colors inline-flex items-center gap-2"
          >
            <Icon class="w-5 h-5" name="bx:bxs-phone" />
            Inquire About Breeding
          </a>
          
          {stud.images && stud.images.length > 0 && (
            <a 
              href="#gallery" 
              class="bg-white/20 hover:bg-white/30 text-white px-8 py-3 rounded-lg font-medium transition-colors inline-flex items-center gap-2"
            >
              <Icon class="w-5 h-5" name="bx:bxs-image" />
              View Gallery
            </a>
          )}
        </div>
      </div>
    </div>
  </div>
</section> 